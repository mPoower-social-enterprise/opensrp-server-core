<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="org.opensrp.repository.postgres.mapper.custom.CustomMhealthEventMetadataMapper">

	<resultMap id="BaseEventResultMap" type="org.opensrp.domain.postgres.Event">
		<id column="id" jdbcType="BIGINT" property="id" />
		<result column="json" jdbcType="OTHER" property="json"
			typeHandler="org.opensrp.repository.postgres.handler.EventTypeHandler" />
	</resultMap>

	<sql id="Base_Event_Column_List">
		e.id, e.json
	</sql>
	<insert id="insertSelective" parameterType="org.opensrp.domain.postgres.MhealthEventMetadata">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 06 12:20:41 EAT 2018.
    -->
    insert into core.event_metadata
	    <trim prefix="(" suffix=")" suffixOverrides=",">
	      <if test="id != null">
	        id,
	      </if>
	      <if test="eventId != null">
	        event_id,
	      </if>
	      <if test="documentId != null">
	        document_id,
	      </if>
	      <if test="baseEntityId != null">
	        base_entity_id,
	      </if>
	      <if test="formSubmissionId != null">
	        form_submission_id,
	      </if>
	      <if test="serverVersion != null">
	        server_version,
	      </if>
	      <if test="openmrsUuid != null">
	        openmrs_uuid,
	      </if>
	      <if test="eventType != null">
	        event_type,
	      </if>
	      <if test="eventDate != null">
	        event_date,
	      </if>
	      <if test="entityType != null">
	        entity_type,
	      </if>
	      <if test="providerId != null">
	        provider_id,
	      </if>
	      <if test="locationId != null">
	        location_id,
	      </if>
	      <if test="team != null">
	        team,
	      </if>
	      <if test="teamId != null">
	        team_id,
	      </if>
	      <if test="dateCreated != null">
	        date_created,
	      </if>
	      <if test="dateEdited != null">
	        date_edited,
	      </if>
	      <if test="dateDeleted != null">
	        date_deleted,
	      </if>
	      <if test="planIdentifier != null">
	        plan_identifier,
	      </if>
	      <if test="district != null">
			district,
		  </if>
		  <if test="division != null">
			division,
		  </if>
		  <if test="branch != null">
			branch,
		  </if>
		  <if test="village != null">
			village,
		  </if>
	    </trim>
	    <trim prefix="values (" suffix=")" suffixOverrides=",">
	      <if test="id != null">
	        #{id,jdbcType=BIGINT},
	      </if>
	      <if test="eventId != null">
	        #{eventId,jdbcType=BIGINT},
	      </if>
	      <if test="documentId != null">
	        #{documentId,jdbcType=VARCHAR},
	      </if>
	      <if test="baseEntityId != null">
	        #{baseEntityId,jdbcType=VARCHAR},
	      </if>
	      <if test="formSubmissionId != null">
	        #{formSubmissionId,jdbcType=VARCHAR},
	      </if>
	      <if test="serverVersion != null">
	        #{serverVersion,jdbcType=BIGINT},
	      </if>
	      <if test="openmrsUuid != null">
	        #{openmrsUuid,jdbcType=VARCHAR},
	      </if>
	      <if test="eventType != null">
	        #{eventType,jdbcType=VARCHAR},
	      </if>
	      <if test="eventDate != null">
	        #{eventDate,jdbcType=TIMESTAMP},
	      </if>
	      <if test="entityType != null">
	        #{entityType,jdbcType=VARCHAR},
	      </if>
	      <if test="providerId != null">
	        #{providerId,jdbcType=VARCHAR},
	      </if>
	      <if test="locationId != null">
	        #{locationId,jdbcType=VARCHAR},
	      </if>
	      <if test="team != null">
	        #{team,jdbcType=VARCHAR},
	      </if>
	      <if test="teamId != null">
	        #{teamId,jdbcType=VARCHAR},
	      </if>
	      <if test="dateCreated != null">
	        #{dateCreated,jdbcType=TIMESTAMP},
	      </if>
	      <if test="dateEdited != null">
	        #{dateEdited,jdbcType=TIMESTAMP},
	      </if>
	      <if test="dateDeleted != null">
	        #{dateDeleted,jdbcType=TIMESTAMP},
	      </if>
	      <if test="planIdentifier != null">
	        #{planIdentifier,jdbcType=VARCHAR},
	      </if>
	      <if test="district != null">
			#{district,jdbcType=VARCHAR},
		  </if>
		  <if test="division != null">
			#{division,jdbcType=VARCHAR},
		  </if>
		  <if test="branch != null">
			#{branch,jdbcType=VARCHAR},
		  </if>
		  <if test="village != null">
			#{village,jdbcType=VARCHAR},
		  </if>
	    </trim>
    </insert>
    <update id="updateByPrimaryKey" parameterType="org.opensrp.domain.postgres.MhealthEventMetadata">
	    <!--
	      WARNING - @mbg.generated
	      This element is automatically generated by MyBatis Generator, do not modify.
	      This element was generated on Fri Apr 06 12:20:41 EAT 2018.
	    -->
	    update core.event_metadata
	    set event_id = #{eventId,jdbcType=BIGINT},
	    document_id = #{documentId,jdbcType=VARCHAR},
	    base_entity_id = #{baseEntityId,jdbcType=VARCHAR},
	    form_submission_id = #{formSubmissionId,jdbcType=VARCHAR},
	    server_version = #{serverVersion,jdbcType=BIGINT},
	    openmrs_uuid = #{openmrsUuid,jdbcType=VARCHAR},
	    event_type = #{eventType,jdbcType=VARCHAR},
	    event_date = #{eventDate,jdbcType=TIMESTAMP},
	    entity_type = #{entityType,jdbcType=VARCHAR},
	    provider_id = #{providerId,jdbcType=VARCHAR},
	    location_id = #{locationId,jdbcType=VARCHAR},
	    team = #{team,jdbcType=VARCHAR},
	    team_id = #{teamId,jdbcType=VARCHAR},
	    date_created = #{dateCreated,jdbcType=TIMESTAMP},
	    date_edited = #{dateEdited,jdbcType=TIMESTAMP},
	    date_deleted = #{dateDeleted,jdbcType=TIMESTAMP},
	    plan_identifier = #{planIdentifier,jdbcType=VARCHAR}
	    district = #{district,jdbcType=VARCHAR},
	    division = #{division,jdbcType=VARCHAR},
	    branch = #{branch,jdbcType=VARCHAR},
	    village = #{village,jdbcType=VARCHAR}
	    where id = #{id,jdbcType=BIGINT}
    </update>    
  
	<select id="selectByDocumentId" parameterType="java.lang.String"
		resultMap="BaseEventResultMap">
		select
		<include refid="Base_Event_Column_List" />
		from core.event_metadata em
		join core.event e on em.event_id = e.id
		where em.document_id = #{documentId,jdbcType=VARCHAR} and em.date_deleted is null
	</select>
	
	<select id="selectPrimaryKey" parameterType="org.opensrp.domain.postgres.EventMetadataExample"
		resultType="java.lang.Long">
		select event_id
		from core.event_metadata${postfix} em
		<if test="_parameter != null">
			<include refid="Event_Example_Where_Clause" />
		</if>
	</select>

	

</mapper>
